(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5],{2913:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var a=r(5155),d=r(8500),i=r.n(d),s=r(5772),c=r(3831),n=r(2482),l=r(1914),o=r(8459),m=r(2115),h=r(7882);function u(){let{data:e,status:t}=(0,h.useSession)(),{items:r,removeItem:d,updateQuantity:u,totalPrice:x,clearCart:g,mode:y,hydrating:p}=(0,c._)(),[b,f]=(0,m.useState)(!1),[j,N]=(0,m.useState)(null),[w,v]=(0,m.useState)(null);if((0,m.useEffect)(()=>{f(!0)},[]),!b)return null;let k="authenticated"===t&&e?.user?.role!=="admin";return(0,a.jsx)("div",{className:"bg-white dark:bg-zinc-900 min-h-screen py-12",children:(0,a.jsxs)("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"flex items-end justify-between gap-4 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-gray-900 dark:text-white",children:"Shopping cart"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Review items and proceed to checkout."})]}),r.length>0&&(0,a.jsx)("button",{type:"button",onClick:async()=>{N(null);try{await g()}catch(e){N(e?.message||"Failed to clear cart")}},className:"text-sm font-medium text-gray-700 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white",children:"Clear cart"})]}),"local"===y&&"unauthenticated"===t&&(0,a.jsxs)("div",{className:"mb-6 rounded-md border border-gray-200 dark:border-zinc-700 bg-gray-50 dark:bg-zinc-800 px-4 py-3 text-sm text-gray-700 dark:text-gray-200 flex items-center justify-between",children:[(0,a.jsx)("span",{children:"Sign in to save your cart and sync across devices."}),(0,a.jsx)(i(),{href:"/auth/login?callbackUrl=/cart",className:"text-indigo-600 hover:text-indigo-700 dark:text-indigo-400 dark:hover:text-indigo-300 font-medium",children:"Sign in"})]}),j&&(0,a.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 dark:bg-zinc-800 dark:border-red-900/40 dark:text-red-300 rounded-md p-4 text-sm",children:j}),k&&p?(0,a.jsxs)("div",{className:"border rounded-lg border-gray-200 dark:border-zinc-800 p-6 animate-pulse",children:[(0,a.jsx)("div",{className:"h-4 w-48 bg-gray-200 dark:bg-zinc-700 rounded"}),(0,a.jsx)("div",{className:"mt-4 h-24 bg-gray-200 dark:bg-zinc-700 rounded"}),(0,a.jsx)("div",{className:"mt-4 h-24 bg-gray-200 dark:bg-zinc-700 rounded"})]}):0===r.length?(0,a.jsxs)("div",{className:"text-center py-12 border rounded-lg border-gray-200 dark:border-zinc-800",children:[(0,a.jsx)("p",{className:"text-lg text-gray-700 dark:text-gray-200 mb-2",children:"Your cart is empty"}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:"Browse products and add something you love."}),(0,a.jsx)(i(),{href:"/products",className:"inline-flex items-center justify-center rounded-md border border-transparent bg-indigo-600 px-6 py-3 text-base font-medium text-white hover:bg-indigo-700",children:"Browse products"})]}):(0,a.jsxs)("div",{className:"lg:grid lg:grid-cols-12 lg:gap-x-12 lg:items-start",children:[(0,a.jsx)("div",{className:"lg:col-span-7",children:(0,a.jsx)("ul",{className:"divide-y divide-gray-200 dark:divide-zinc-800 border-t border-b border-gray-200 dark:border-zinc-800",children:r.map(e=>(0,a.jsxs)("li",{className:"flex py-6 sm:py-10",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(s.default,{src:e.product.image_url||"https://images.unsplash.com/photo-1496062031456-07b8f162a322?w=800&q=80",alt:e.product.name,width:96,height:96,className:"h-24 w-24 rounded-md object-cover object-center sm:h-48 sm:w-48"})}),(0,a.jsx)("div",{className:"ml-4 flex flex-1 flex-col justify-between sm:ml-6",children:(0,a.jsxs)("div",{className:"relative pr-9 sm:grid sm:grid-cols-2 sm:gap-x-6 sm:pr-0",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"flex justify-between",children:(0,a.jsx)("h3",{className:"text-sm",children:(0,a.jsx)(i(),{href:`/product?id=${e.product_id}`,className:"font-medium text-gray-700 dark:text-white hover:text-gray-900 dark:hover:text-white",children:e.product.name})})}),(0,a.jsx)("div",{className:"mt-1 flex text-sm",children:(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:e.product.category})}),(0,a.jsxs)("p",{className:"mt-1 text-sm font-medium text-gray-900 dark:text-white",children:["₹",e.product.price]})]}),(0,a.jsxs)("div",{className:"mt-4 sm:mt-0 sm:pr-9",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("button",{disabled:w===e.product_id,onClick:async()=>{v(e.product_id),N(null);try{await u(e.product_id,Math.max(1,e.quantity-1))}catch(e){N(e?.message||"Failed to update cart")}finally{v(null)}},className:"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-zinc-800",children:(0,a.jsx)(n.A,{className:"h-4 w-4 text-gray-500"})}),(0,a.jsx)("span",{className:"text-gray-900 dark:text-white",children:e.quantity}),(0,a.jsx)("button",{disabled:w===e.product_id,onClick:async()=>{v(e.product_id),N(null);try{await u(e.product_id,e.quantity+1)}catch(e){N(e?.message||"Failed to update cart")}finally{v(null)}},className:"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-zinc-800",children:(0,a.jsx)(l.A,{className:"h-4 w-4 text-gray-500"})})]}),(0,a.jsx)("div",{className:"absolute right-0 top-0",children:(0,a.jsxs)("button",{type:"button",disabled:w===e.product_id,onClick:async()=>{v(e.product_id),N(null);try{await d(e.product_id)}catch(e){N(e?.message||"Failed to remove item")}finally{v(null)}},className:"-m-2 inline-flex p-2 text-gray-400 hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-200",children:[(0,a.jsx)("span",{className:"sr-only",children:"Remove"}),(0,a.jsx)(o.A,{className:"h-5 w-5"})]})})]})]})})]},e.product_id))})}),(0,a.jsxs)("div",{className:"mt-10 rounded-lg bg-gray-50 dark:bg-zinc-800 px-4 py-6 sm:p-6 lg:col-span-5 lg:mt-0 lg:p-8",children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Order summary"}),(0,a.jsxs)("dl",{className:"mt-6 space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("dt",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Subtotal"}),(0,a.jsxs)("dd",{className:"text-sm font-medium text-gray-900 dark:text-white",children:["₹",x().toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between border-t border-gray-200 dark:border-zinc-700 pt-4",children:[(0,a.jsx)("dt",{className:"text-base font-medium text-gray-900 dark:text-white",children:"Order total"}),(0,a.jsxs)("dd",{className:"text-base font-medium text-gray-900 dark:text-white",children:["₹",x().toFixed(2)]})]})]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)(i(),{href:"/checkout",className:"w-full flex items-center justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-3 text-base font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 focus:ring-offset-gray-50",children:"Checkout"})})]})]})]})})}},3831:(e,t,r)=>{"use strict";r.d(t,{_:()=>i});var a=r(1934),d=r(9311);let i=(0,a.v)()((0,d.Zr)((e,t)=>({items:[],mode:"local",hydrating:!1,setMode:t=>e({mode:t}),hydrateFromDb:async()=>{if("db"!==t().mode)return;e({hydrating:!0});let r=await fetch("/api/cart/list",{method:"GET",headers:{"Cache-Control":"no-cache"}}),a=await r.json().catch(()=>null);try{if(!r.ok)throw Error(a?.error||"Failed to load cart");e({items:Array.isArray(a?.items)?a.items:[]})}finally{e({hydrating:!1})}},addItem:async(r,a=1)=>{let d=Number.isFinite(a)?Math.max(1,Math.floor(a)):1;if("db"===t().mode){e(e=>e.items.find(e=>e.product_id===r.id)?{items:e.items.map(e=>e.product_id===r.id?{...e,quantity:e.quantity+d}:e)}:{items:[...e.items,{id:"pending",user_id:"",product_id:r.id,quantity:d,product:r}]});let a=await fetch("/api/cart/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:r.id,quantity:d})}),i=await a.json().catch(()=>null);if(!a.ok)throw await t().hydrateFromDb(),Error(i?.error||"Failed to add to cart");await t().hydrateFromDb();return}e(e=>e.items.find(e=>e.product_id===r.id)?{items:e.items.map(e=>e.product_id===r.id?{...e,quantity:e.quantity+d}:e)}:{items:[...e.items,{id:Math.random().toString(36).substring(7),user_id:"",product_id:r.id,quantity:d,product:r}]})},removeItem:async r=>{if("db"===t().mode){e(e=>({items:e.items.filter(e=>e.product_id!==r)}));let a=await fetch("/api/cart/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:r})}),d=await a.json().catch(()=>null);if(!a.ok)throw await t().hydrateFromDb(),Error(d?.error||"Failed to remove from cart");return}e(e=>({items:e.items.filter(e=>e.product_id!==r)}))},updateQuantity:async(r,a)=>{if("db"===t().mode){e(e=>({items:e.items.map(e=>e.product_id===r?{...e,quantity:a}:e).filter(e=>e.quantity>0)}));let d=await fetch("/api/cart/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:r,quantity:a})}),i=await d.json().catch(()=>null);if(!d.ok)throw await t().hydrateFromDb(),Error(i?.error||"Failed to update cart");return}e(e=>({items:e.items.map(e=>e.product_id===r?{...e,quantity:a}:e)}))},clearCart:async()=>{if("db"===t().mode){e({items:[]});let r=await fetch("/api/cart/clear",{method:"POST"}),a=await r.json().catch(()=>null);if(!r.ok)throw await t().hydrateFromDb(),Error(a?.error||"Failed to clear cart");return}e({items:[]})},totalItems:()=>t().items.reduce((e,t)=>e+t.quantity,0),totalPrice:()=>t().items.reduce((e,t)=>e+t.product.price*t.quantity,0)}),{name:"cart-storage"}))},8136:(e,t,r)=>{Promise.resolve().then(r.bind(r,2913))}},e=>{e.O(0,[500,437,909,64,441,794,358],()=>e(e.s=8136)),_N_E=e.O()}]);