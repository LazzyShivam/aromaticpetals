(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[410],{2258:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o,dynamic:()=>d});var s=a(5155),i=a(2115);let d="force-dynamic";function n(e){if(!e)return"";let t=new Date(e);if(Number.isNaN(t.getTime()))return"";let a=e=>String(e).padStart(2,"0");return`${t.getFullYear()}-${a(t.getMonth()+1)}-${a(t.getDate())}T${a(t.getHours())}:${a(t.getMinutes())}`}function r(e){if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t.toISOString()}function o(){let e="mt-1 block w-full rounded-md border border-gray-300 dark:border-zinc-700 bg-white dark:bg-zinc-900 text-gray-900 dark:text-white px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",[t,a]=(0,i.useState)([]),[d,o]=(0,i.useState)(!0),[c,l]=(0,i.useState)(!1),[u,m]=(0,i.useState)(!1),[x,p]=(0,i.useState)(null),[g,h]=(0,i.useState)({id:void 0,code:"",description:"",discount_type:"percent",discount_value:"",min_order_amount:"0",max_discount:"",usage_limit:"",starts_at:"",ends_at:"",is_active:!0}),y=!!g.id,b=(0,i.useMemo)(()=>"percent"===g.discount_type?"e.g. 10 means 10% off":"e.g. 100 means ₹100 off",[g.discount_type]),_=(0,i.useCallback)(async()=>{o(!0),p(null);try{let e=await fetch("/api/admin/coupons/list",{method:"GET",headers:{"Cache-Control":"no-cache"}}),t=await e.json().catch(()=>null);if(!e.ok)throw Error(t?.error||"Failed to load coupons");a(Array.isArray(t?.coupons)?t.coupons:[])}catch(e){p(e?.message||"Failed to load coupons"),a([])}finally{o(!1)}},[]);function v(){h({id:void 0,code:"",description:"",discount_type:"percent",discount_value:"",min_order_amount:"0",max_discount:"",usage_limit:"",starts_at:"",ends_at:"",is_active:!0})}async function f(e){e.preventDefault(),l(!0),p(null);try{let e=await fetch("/api/admin/coupons/upsert",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:g.id,code:g.code,description:g.description,discount_type:g.discount_type,discount_value:g.discount_value,min_order_amount:g.min_order_amount,max_discount:g.max_discount,usage_limit:g.usage_limit,starts_at:r(g.starts_at),ends_at:r(g.ends_at),is_active:g.is_active})}),t=await e.json().catch(()=>null);if(!e.ok)throw Error(t?.error||(y?"Failed to update coupon":"Failed to create coupon"));m(!1),v(),await _()}catch(e){p(e?.message||"Failed to save coupon")}finally{l(!1)}}async function j(e){if(window.confirm("Delete this coupon? This cannot be undone.")){p(null);try{let t=await fetch("/api/admin/coupons/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}),a=await t.json().catch(()=>null);if(!t.ok)throw Error(a?.error||"Failed to delete coupon");await _()}catch(e){p(e?.message||"Failed to delete coupon")}}}return(0,i.useEffect)(()=>{_()},[_]),(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Coupons"}),(0,s.jsx)("button",{type:"button",onClick:()=>{u?(m(!1),v()):m(!0)},className:"bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700",children:u?"Close":"Add Coupon"})]}),x&&(0,s.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 dark:bg-zinc-800 dark:border-red-900/40 dark:text-red-300 rounded-md p-4 text-sm",children:x}),u&&(0,s.jsxs)("form",{onSubmit:f,className:"mb-6 bg-white dark:bg-zinc-800 shadow-sm rounded-lg p-6",children:[(0,s.jsx)("div",{className:"flex items-start justify-between gap-4 mb-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-base font-semibold text-gray-900 dark:text-white",children:y?"Edit coupon":"New coupon"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Create a coupon code customers can apply at checkout."})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Code"}),(0,s.jsx)("input",{value:g.code,onChange:e=>h(t=>({...t,code:e.target.value.toUpperCase()})),className:e,placeholder:"WELCOME10",required:!0,disabled:c})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Status"}),(0,s.jsxs)("div",{className:"mt-2 flex items-center gap-2",children:[(0,s.jsx)("input",{id:"is_active",type:"checkbox",checked:g.is_active,onChange:e=>h(t=>({...t,is_active:e.target.checked})),className:"h-4 w-4 rounded border-gray-300",disabled:c}),(0,s.jsx)("label",{htmlFor:"is_active",className:"text-sm text-gray-700 dark:text-gray-300",children:"Active"})]})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),(0,s.jsx)("input",{value:g.description,onChange:e=>h(t=>({...t,description:e.target.value})),className:e,placeholder:"10% off on your first order",disabled:c})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Discount type"}),(0,s.jsxs)("select",{value:g.discount_type,onChange:e=>h(t=>({...t,discount_type:"amount"===e.target.value?"amount":"percent"})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-zinc-700 bg-white dark:bg-zinc-900 text-gray-900 dark:text-white px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",disabled:c,children:[(0,s.jsx)("option",{value:"percent",children:"Percent (%)"}),(0,s.jsx)("option",{value:"amount",children:"Amount (₹)"})]}),(0,s.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:b})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Discount value"}),(0,s.jsx)("input",{type:"number",inputMode:"decimal",value:g.discount_value,onChange:e=>h(t=>({...t,discount_value:e.target.value})),className:e,required:!0,disabled:c})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Minimum order (₹)"}),(0,s.jsx)("input",{type:"number",inputMode:"decimal",value:g.min_order_amount,onChange:e=>h(t=>({...t,min_order_amount:e.target.value})),className:e,min:0,step:"0.01",disabled:c})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Max discount (₹) (optional)"}),(0,s.jsx)("input",{type:"number",inputMode:"decimal",value:g.max_discount,onChange:e=>h(t=>({...t,max_discount:e.target.value})),className:e,min:0,step:"0.01",disabled:c})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Usage limit (optional)"}),(0,s.jsx)("input",{type:"number",inputMode:"numeric",value:g.usage_limit,onChange:e=>h(t=>({...t,usage_limit:e.target.value})),className:e,min:0,step:1,disabled:c})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Starts at (optional)"}),(0,s.jsx)("input",{type:"datetime-local",value:g.starts_at,onChange:e=>h(t=>({...t,starts_at:e.target.value})),className:e,disabled:c})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Ends at (optional)"}),(0,s.jsx)("input",{type:"datetime-local",value:g.ends_at,onChange:e=>h(t=>({...t,ends_at:e.target.value})),className:e,disabled:c})]})]}),(0,s.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{m(!1),v()},className:"px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 border border-gray-300 dark:border-zinc-700 hover:bg-gray-50 dark:hover:bg-zinc-700",disabled:c,children:"Cancel"}),(0,s.jsx)("button",{type:"submit",disabled:c,className:"px-4 py-2 rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50",children:c?"Saving…":y?"Save changes":"Create coupon"})]})]}),(0,s.jsx)("div",{className:"bg-white dark:bg-zinc-800 shadow-sm rounded-lg overflow-hidden",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-zinc-700",children:[(0,s.jsx)("thead",{className:"bg-gray-50 dark:bg-zinc-700",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Code"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Discount"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Min"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Used"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"bg-white dark:bg-zinc-800 divide-y divide-gray-200 dark:divide-zinc-700",children:d?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"px-6 py-6 text-sm text-gray-500 dark:text-gray-400",colSpan:6,children:"Loading…"})}):0===t.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"px-6 py-6 text-sm text-gray-500 dark:text-gray-400",colSpan:6,children:"No coupons."})}):t.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-white",children:e.code}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:["percent"===e.discount_type?`${e.discount_value}%`:`₹${e.discount_value}`,null!==e.max_discount?` (max ₹${e.max_discount})`:""]}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:["₹",e.min_order_amount]}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.used_count,null!==e.usage_limit?` / ${e.usage_limit}`:""]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,s.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${e.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:e.is_active?"Active":"Inactive"})}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-right",children:(0,s.jsxs)("div",{className:"inline-flex gap-3",children:[(0,s.jsx)("button",{type:"button",onClick:()=>{m(!0),p(null),h({id:e.id,code:e.code,description:e.description||"",discount_type:e.discount_type,discount_value:String(e.discount_value),min_order_amount:String(e.min_order_amount??0),max_discount:null===e.max_discount?"":String(e.max_discount),usage_limit:null===e.usage_limit?"":String(e.usage_limit),starts_at:n(e.starts_at),ends_at:n(e.ends_at),is_active:!!e.is_active})},className:"text-indigo-600 hover:text-indigo-700 dark:text-indigo-400",children:"Edit"}),(0,s.jsx)("button",{type:"button",onClick:()=>j(e.id),className:"text-red-600 hover:text-red-700 dark:text-red-400",children:"Delete"})]})})]},e.id))})]})})]})}},6289:(e,t,a)=>{Promise.resolve().then(a.bind(a,2258))}},e=>{e.O(0,[441,794,358],()=>e(e.s=6289)),_N_E=e.O()}]);