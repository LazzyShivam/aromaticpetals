(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[279],{3831:(e,t,s)=>{"use strict";s.d(t,{_:()=>i});var a=s(1934),r=s(9311);let i=(0,a.v)()((0,r.Zr)((e,t)=>({items:[],addItem:t=>{e(e=>e.items.find(e=>e.product_id===t.id)?{items:e.items.map(e=>e.product_id===t.id?{...e,quantity:e.quantity+1}:e)}:{items:[...e.items,{id:Math.random().toString(36).substring(7),user_id:"",product_id:t.id,quantity:1,product:t}]})},removeItem:t=>{e(e=>({items:e.items.filter(e=>e.product_id!==t)}))},updateQuantity:(t,s)=>{e(e=>({items:e.items.map(e=>e.product_id===t?{...e,quantity:s}:e)}))},clearCart:()=>{e({items:[]})},totalItems:()=>t().items.reduce((e,t)=>e+t.quantity,0),totalPrice:()=>t().items.reduce((e,t)=>e+t.product.price*t.quantity,0)}),{name:"cart-storage"}))},5506:(e,t,s)=>{Promise.resolve().then(s.bind(s,7667))},7667:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>m});var a=s(5155),r=s(2115),i=s(3321),d=s(3831),n=s(7882),o=s(5596),l=s(5772),c=s(6296);function m(){let e=(0,i.useRouter)(),{data:t,status:s}=(0,n.useSession)(),{items:m,totalPrice:u,clearCart:x}=(0,d._)(),[h,p]=(0,r.useState)(!1),[g,y]=(0,r.useState)({name:"",address:"",city:"",state:"",zip:"",phone:""});if((0,r.useEffect)(()=>{"unauthenticated"===s&&e.push("/auth/login?callbackUrl=/checkout")},[s,e]),"loading"===s||!t)return(0,a.jsx)("div",{className:"flex justify-center py-24",children:(0,a.jsx)(c.A,{className:"animate-spin h-8 w-8 text-indigo-600"})});if(0===m.length)return e.push("/cart"),null;let f=e=>{let{name:t,value:s}=e.target;y(e=>({...e,[t]:s}))},b=async s=>{s.preventDefault(),p(!0);try{let s=await fetch("/api/payment/create-order",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:u(),currency:"INR",receipt:`rcpt_${Date.now()}`})}),a=(s.headers.get("content-type")||"").includes("application/json")?await s.json():await s.text();if(!s.ok)throw Error("string"==typeof a?a:a.error);let r={key:"your-razorpay-key-id",amount:a.amount,currency:a.currency,name:"Aromatic Petals",description:"Order Payment",order_id:a.id,handler:async function(t){try{let s=await fetch("/api/orders/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({items:m,total_amount:u(),shipping_address:g,payment_id:t.razorpay_payment_id})});if(!s.ok){let e=(s.headers.get("content-type")||"").includes("application/json")?await s.json():await s.text();throw Error("string"==typeof e?e:e.error||"Failed to create order")}x(),e.push("/profile")}catch(e){console.error(e),alert("Payment successful but failed to create order record. Please contact support.")}},prefill:{name:g.name,email:t.user?.email,contact:g.phone},theme:{color:"#4F46E5"}};new window.Razorpay(r).open()}catch(e){console.error(e),alert(e.message||"Payment initiation failed")}finally{p(!1)}};return(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-zinc-900 min-h-screen py-12",children:[(0,a.jsx)(o.default,{src:"https://checkout.razorpay.com/v1/checkout.js"}),(0,a.jsxs)("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold tracking-tight text-gray-900 dark:text-white mb-8",children:"Checkout"}),(0,a.jsxs)("div",{className:"lg:grid lg:grid-cols-2 lg:gap-x-12 xl:gap-x-16",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Shipping Information"}),(0,a.jsxs)("form",{onSubmit:b,className:"mt-4 grid grid-cols-1 gap-y-6 sm:grid-cols-2 sm:gap-x-4",children:[(0,a.jsxs)("div",{className:"sm:col-span-2",children:[(0,a.jsx)("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Full Name"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("input",{type:"text",id:"name",name:"name",required:!0,value:g.name,onChange:f,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border"})})]}),(0,a.jsxs)("div",{className:"sm:col-span-2",children:[(0,a.jsx)("label",{htmlFor:"address",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Address"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("input",{type:"text",id:"address",name:"address",required:!0,value:g.address,onChange:f,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"city",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"City"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("input",{type:"text",id:"city",name:"city",required:!0,value:g.city,onChange:f,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"state",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"State"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("input",{type:"text",id:"state",name:"state",required:!0,value:g.state,onChange:f,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"zip",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"ZIP / Postal Code"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("input",{type:"text",id:"zip",name:"zip",required:!0,value:g.zip,onChange:f,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"phone",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Phone"}),(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)("input",{type:"tel",id:"phone",name:"phone",required:!0,value:g.phone,onChange:f,className:"block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border"})})]}),(0,a.jsx)("div",{className:"sm:col-span-2 mt-6",children:(0,a.jsx)("button",{type:"submit",disabled:h,className:"w-full rounded-md border border-transparent bg-indigo-600 px-4 py-3 text-base font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",children:h?"Processing...":`Pay ₹${u().toFixed(2)}`})})]})]}),(0,a.jsxs)("div",{className:"mt-10 lg:mt-0",children:[(0,a.jsx)("h2",{className:"text-lg font-medium text-gray-900 dark:text-white",children:"Order Summary"}),(0,a.jsxs)("div",{className:"mt-4 rounded-lg border border-gray-200 dark:border-zinc-700 bg-white dark:bg-zinc-800 shadow-sm",children:[(0,a.jsx)("ul",{role:"list",className:"divide-y divide-gray-200 dark:divide-zinc-700",children:m.map(e=>(0,a.jsxs)("li",{className:"flex py-6 px-4 sm:px-6",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)(l.default,{src:e.product.image_url||"https://images.unsplash.com/photo-1496062031456-07b8f162a322?w=800&q=80",alt:e.product.name,width:80,height:80,className:"h-20 w-20 rounded-md object-cover object-center"})}),(0,a.jsxs)("div",{className:"ml-6 flex flex-1 flex-col",children:[(0,a.jsx)("div",{className:"flex",children:(0,a.jsxs)("div",{className:"min-w-0 flex-1",children:[(0,a.jsx)("h4",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:e.product.name}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:e.product.category})]})}),(0,a.jsx)("div",{className:"flex flex-1 items-end justify-between pt-2",children:(0,a.jsxs)("p",{className:"mt-1 text-sm font-medium text-gray-900 dark:text-white",children:["₹",e.product.price," x ",e.quantity]})})]})]},e.product_id))}),(0,a.jsx)("dl",{className:"border-t border-gray-200 dark:border-zinc-700 py-6 px-4 space-y-6 sm:px-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("dt",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Total"}),(0,a.jsxs)("dd",{className:"text-base font-medium text-gray-900 dark:text-white",children:["₹",u().toFixed(2)]})]})})]})]})]})]})]})}}},e=>{e.O(0,[437,909,107,441,794,358],()=>e(e.s=5506)),_N_E=e.O()}]);