(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[575],{7379:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o,dynamic:()=>l});var r=a(5155),i=a(8500),d=a.n(i),s=a(2115);let l="force-dynamic";function o(){let e=(0,s.useMemo)(()=>["Flowers","Candles","Plants","Gifts","Uncategorized"],[]),t="mt-1 block w-full rounded-md border border-gray-300 dark:border-zinc-700 bg-white dark:bg-zinc-900 text-gray-900 dark:text-white px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",[a,i]=(0,s.useState)([]),[l,o]=(0,s.useState)(!0),[c,n]=(0,s.useState)(!1),[m,x]=(0,s.useState)(!1),[p,h]=(0,s.useState)(null),[g,u]=(0,s.useState)([]),[y,b]=(0,s.useState)(null),[f,k]=(0,s.useState)(null),[j,v]=(0,s.useState)([]),[w,N]=(0,s.useState)(!1),[_,C]=(0,s.useState)(!1),[S,z]=(0,s.useState)(null),[F,T]=(0,s.useState)({id:void 0,name:"",description:"",category:"Flowers",price:"",stock_quantity:"",is_active:!0}),E=!!F.id,O=(0,s.useCallback)(async()=>{o(!0),h(null);try{let e=await fetch("/api/admin/products/list",{method:"GET",headers:{"Cache-Control":"no-cache"}}),t=await e.json().catch(()=>null);if(!e.ok)throw Error(t?.error||"Failed to load products");i(Array.isArray(t?.products)?t.products:[])}catch(e){h(e?.message||"Failed to load products"),i([])}finally{o(!1)}},[]),P=(0,s.useCallback)(async e=>{N(!0),z(null);try{let t=await fetch(`/api/admin/products/media/list?product_id=${encodeURIComponent(e)}`,{method:"GET",headers:{"Cache-Control":"no-cache"}}),a=await t.json().catch(()=>null);if(!t.ok)throw Error(a?.error||"Failed to load media");v(Array.isArray(a?.media)?a.media:[])}catch(e){z(e?.message||"Failed to load media"),v([])}finally{N(!1)}},[]),q=(0,s.useCallback)(async e=>{if(f){C(!0),z(null);try{for(let t of Array.from(e)){let e=t.type.startsWith("video/")?"video":"image",a=await fetch("/api/admin/products/media/create-signed-upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:f.id,file_name:t.name,content_type:t.type||("video"===e?"video/mp4":"image/jpeg"),media_type:e})}),r=await a.json().catch(()=>null);if(!a.ok)throw Error(r?.error||"Failed to start upload");if(!(await fetch(r.signedUrl,{method:"PUT",headers:{"Content-Type":r.contentType},body:t})).ok)throw Error("Upload failed");let i=await fetch("/api/admin/products/media/commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:f.id,media_type:e,storage_path:r.path,public_url:r.publicUrl,sort_order:j.length})}),d=await i.json().catch(()=>null);if(!i.ok)throw Error(d?.error||"Failed to save media")}await P(f.id),await O()}catch(e){z(e?.message||"Upload failed")}finally{C(!1)}}},[P,O,j.length,f]),U=(0,s.useCallback)(async(e,t)=>{if(e&&0!==t.length){b(null);try{for(let a of t){let t=a.type.startsWith("video/")?"video":"image",r=await fetch("/api/admin/products/media/create-signed-upload",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,file_name:a.name,content_type:a.type||("video"===t?"video/mp4":"image/jpeg"),media_type:t})}),i=await r.json().catch(()=>null);if(!r.ok)throw Error(i?.error||"Failed to start upload");if(!(await fetch(i.signedUrl,{method:"PUT",headers:{"Content-Type":i.contentType},body:a})).ok)throw Error("Upload failed");let d=await fetch("/api/admin/products/media/commit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:e,media_type:t,storage_path:i.path,public_url:i.publicUrl,sort_order:0})}),s=await d.json().catch(()=>null);if(!d.ok)throw Error(s?.error||"Failed to save media")}}catch(e){b(e?.message||"Upload failed")}}},[]),A=(0,s.useCallback)(async e=>{if(f){z(null);try{let t=await fetch("/api/admin/products/media/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}),a=await t.json().catch(()=>null);if(!t.ok)throw Error(a?.error||"Failed to delete media");await P(f.id),await O()}catch(e){z(e?.message||"Failed to delete media")}}},[P,O,f]);async function J(e){e.preventDefault(),x(!0),h(null),b(null);try{let e=await fetch(E?"/api/admin/products/update":"/api/admin/products/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:F.id,name:F.name,description:F.description,category:F.category,price:F.price,stock_quantity:F.stock_quantity,is_active:F.is_active})}),t=await e.json().catch(()=>null);if(!e.ok)throw Error(t?.error||(E?"Failed to update product":"Failed to create product"));let a=t?.product?.id||F.id;a&&g.length>0&&await U(a,g),n(!1),T({id:void 0,name:"",description:"",category:"Flowers",price:"",stock_quantity:"",is_active:!0}),u([]),await O()}catch(e){h(e?.message||(E?"Failed to update product":"Failed to create product"))}finally{x(!1)}}async function M(e){if(window.confirm("Delete this product? This cannot be undone.")){h(null);try{let t=await fetch("/api/admin/products/delete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})}),a=await t.json().catch(()=>null);if(!t.ok)throw Error(a?.error||"Failed to delete product");await O()}catch(e){h(e?.message||"Failed to delete product")}}}return(0,s.useEffect)(()=>{O()},[O]),(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold text-gray-900 dark:text-white",children:"Products"}),(0,r.jsx)("button",{type:"button",onClick:()=>{c?(n(!1),T({id:void 0,name:"",description:"",category:"Flowers",price:"",stock_quantity:"",is_active:!0}),u([]),b(null)):n(!0)},className:"bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700",children:c?"Close":"Add Product"})]}),c&&(0,r.jsxs)("form",{onSubmit:J,className:"mb-6 bg-white dark:bg-zinc-800 shadow-sm rounded-lg p-6",children:[(0,r.jsx)("div",{className:"flex items-start justify-between gap-4 mb-4",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-base font-semibold text-gray-900 dark:text-white",children:E?"Edit product":"New product"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:E?"Update details and save changes.":"Create a new product for your store."})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Name"}),(0,r.jsx)("input",{type:"text",value:F.name,onChange:e=>T(t=>({...t,name:e.target.value})),className:t,placeholder:"Product name",required:!0,disabled:m})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Category"}),(0,r.jsx)("select",{value:F.category,onChange:e=>T(t=>({...t,category:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-zinc-700 bg-white dark:bg-zinc-900 text-gray-900 dark:text-white px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",disabled:m,children:e.map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Price"}),(0,r.jsx)("input",{type:"number",inputMode:"decimal",min:0,step:"0.01",value:F.price,onChange:e=>T(t=>({...t,price:e.target.value})),className:t,placeholder:"0.00",required:!0,disabled:m})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Quantity"}),(0,r.jsx)("input",{type:"number",inputMode:"numeric",min:0,step:1,value:F.stock_quantity,onChange:e=>T(t=>({...t,stock_quantity:e.target.value})),className:t,placeholder:"0",required:!0,disabled:m})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Images / Videos"}),(0,r.jsx)("input",{type:"file",multiple:!0,accept:"image/*,video/*",disabled:m,onChange:e=>{u(e.target.files?Array.from(e.target.files):[]),e.target.value=""},className:"mt-1 block w-full text-sm text-gray-700 dark:text-gray-200 file:mr-4 file:py-2 file:px-3 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-indigo-600 file:text-white hover:file:bg-indigo-700"}),(0,r.jsxs)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:["Files will upload automatically when you click ",E?"Save changes":"Create product","."]}),g.length>0&&(0,r.jsxs)("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-300",children:["Selected: ",g.length," file(s)"]}),y&&(0,r.jsx)("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:y})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Description"}),(0,r.jsx)("textarea",{value:F.description,onChange:e=>T(t=>({...t,description:e.target.value})),className:"mt-1 block w-full rounded-md border border-gray-300 dark:border-zinc-700 bg-white dark:bg-zinc-900 text-gray-900 dark:text-white px-3 py-2 shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500",rows:3,placeholder:"Optional description",disabled:m})]}),(0,r.jsxs)("div",{className:"md:col-span-2 flex items-center gap-2",children:[(0,r.jsx)("input",{id:"is_active",type:"checkbox",checked:F.is_active,onChange:e=>T(t=>({...t,is_active:e.target.checked})),className:"h-4 w-4 rounded border-gray-300",disabled:m}),(0,r.jsx)("label",{htmlFor:"is_active",className:"text-sm text-gray-700 dark:text-gray-300",children:"Active"})]})]}),(0,r.jsxs)("div",{className:"mt-4 flex items-center justify-end gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{n(!1),T({id:void 0,name:"",description:"",category:"Flowers",price:"",stock_quantity:"",is_active:!0}),u([]),b(null)},className:"px-4 py-2 rounded-md text-sm font-medium text-gray-700 dark:text-gray-200 border border-gray-300 dark:border-zinc-700 hover:bg-gray-50 dark:hover:bg-zinc-700",disabled:m,children:"Cancel"}),(0,r.jsx)("button",{type:"submit",disabled:m,className:"bg-indigo-600 disabled:opacity-60 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700",children:m?E?"Saving…":"Creating…":E?"Save changes":"Create product"})]})]}),p&&(0,r.jsx)("div",{className:"mb-6 bg-red-50 border border-red-200 text-red-700 dark:bg-zinc-800 dark:border-red-900/40 dark:text-red-300 rounded-md p-4 text-sm",children:p}),(0,r.jsx)("div",{className:"bg-white dark:bg-zinc-800 shadow-sm rounded-lg overflow-hidden",children:(0,r.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-zinc-700",children:[(0,r.jsx)("thead",{className:"bg-gray-50 dark:bg-zinc-700",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Name"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Category"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Price"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Stock"}),(0,r.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Status"}),(0,r.jsx)("th",{className:"px-6 py-3 relative",children:(0,r.jsx)("span",{className:"sr-only",children:"Actions"})})]})}),(0,r.jsx)("tbody",{className:"bg-white dark:bg-zinc-800 divide-y divide-gray-200 dark:divide-zinc-700",children:l?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{className:"px-6 py-6 text-sm text-gray-500 dark:text-gray-400",colSpan:6,children:"Loading…"})}):0===a.length?(0,r.jsx)("tr",{children:(0,r.jsx)("td",{className:"px-6 py-6 text-sm text-gray-500 dark:text-gray-400",colSpan:6,children:"No products."})}):a.map(e=>(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"h-10 w-10 flex-shrink-0",children:(0,r.jsx)("img",{className:"h-10 w-10 rounded-full object-cover",src:e.image_url||"https://images.unsplash.com/photo-1496062031456-07b8f162a322?w=200&q=80",alt:""})}),(0,r.jsx)("div",{className:"ml-4",children:(0,r.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name})})]})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.category}),(0,r.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:["₹",e.price]}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.stock_quantity}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,r.jsx)("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${e.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.is_active?"Active":"Inactive"})}),(0,r.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,r.jsx)("button",{type:"button",onClick:()=>{k(e),v([]),P(e.id)},className:"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white",children:"Media"}),(0,r.jsx)("button",{type:"button",onClick:()=>{n(!0),h(null),T({id:e.id,name:e.name||"",description:e.description||"",category:e.category||"Uncategorized",price:String(e.price??""),stock_quantity:String(e.stock_quantity??""),is_active:!!e.is_active}),u([]),b(null)},className:"text-indigo-600 hover:text-indigo-900 dark:text-indigo-400 dark:hover:text-indigo-300",children:"Edit"}),(0,r.jsx)("button",{type:"button",onClick:()=>M(e.id),className:"text-red-600 hover:text-red-800 dark:text-red-400 dark:hover:text-red-300",children:"Delete"}),(0,r.jsx)(d(),{href:`/product?id=${e.id}`,className:"text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white",children:"Preview"})]})})]},e.id))})]})}),f&&(0,r.jsxs)("div",{className:"fixed inset-0 z-50",children:[(0,r.jsx)("div",{className:"absolute inset-0 bg-black/40",onClick:()=>{_||(k(null),v([]),z(null))}}),(0,r.jsxs)("div",{className:"absolute right-0 top-0 h-full w-full sm:w-[520px] bg-white dark:bg-zinc-900 border-l border-gray-200 dark:border-zinc-800 shadow-xl overflow-y-auto",children:[(0,r.jsxs)("div",{className:"p-5 border-b border-gray-200 dark:border-zinc-800 flex items-start justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Manage media"}),(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:f.name})]}),(0,r.jsx)("button",{type:"button",disabled:_,onClick:()=>{k(null),v([]),z(null)},className:"text-sm font-medium text-gray-700 hover:text-gray-900 dark:text-gray-200",children:"Close"})]}),(0,r.jsxs)("div",{className:"p-5",children:[S&&(0,r.jsx)("div",{className:"mb-4 bg-red-50 border border-red-200 text-red-700 dark:bg-zinc-800 dark:border-red-900/40 dark:text-red-300 rounded-md p-3 text-sm",children:S}),(0,r.jsxs)("div",{className:"rounded-md border border-gray-200 dark:border-zinc-800 p-4 bg-gray-50 dark:bg-zinc-800",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Upload images / videos"}),(0,r.jsx)("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:"You can select multiple files."}),(0,r.jsx)("input",{type:"file",multiple:!0,accept:"image/*,video/*",disabled:_,onChange:e=>{e.target.files&&e.target.files.length>0&&(q(e.target.files),e.target.value="")},className:"mt-3 block w-full text-sm text-gray-700 dark:text-gray-200 file:mr-4 file:py-2 file:px-3 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-indigo-600 file:text-white hover:file:bg-indigo-700"}),_&&(0,r.jsx)("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:"Uploading…"})]}),(0,r.jsxs)("div",{className:"mt-6",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:"Media"}),w&&(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading…"})]}),w||0!==j.length?(0,r.jsx)("div",{className:"mt-3 grid grid-cols-2 gap-3",children:j.map(e=>(0,r.jsxs)("div",{className:"rounded-md border border-gray-200 dark:border-zinc-800 overflow-hidden bg-white dark:bg-zinc-900",children:[(0,r.jsx)("div",{className:"aspect-square bg-gray-100 dark:bg-zinc-800",children:"video"===e.media_type?(0,r.jsx)("video",{src:e.public_url,controls:!0,className:"w-full h-full object-cover"}):(0,r.jsx)("img",{src:e.public_url,alt:"",className:"w-full h-full object-cover"})}),(0,r.jsxs)("div",{className:"p-2 flex items-center justify-between gap-2",children:[(0,r.jsx)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.media_type}),(0,r.jsx)("button",{type:"button",disabled:_,onClick:()=>void A(e.id),className:"text-xs font-medium text-red-600 hover:text-red-700 dark:text-red-400",children:"Delete"})]})]},e.id))}):(0,r.jsx)("p",{className:"mt-3 text-sm text-gray-500 dark:text-gray-400",children:"No media uploaded yet."})]})]})]})]})]})}},8568:(e,t,a)=>{Promise.resolve().then(a.bind(a,7379))}},e=>{e.O(0,[500,441,794,358],()=>e(e.s=8568)),_N_E=e.O()}]);