(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[362,403],{1316:(t,e,i)=>{Promise.resolve().then(i.t.bind(i,8500,23)),Promise.resolve().then(i.t.bind(i,8437,23)),Promise.resolve().then(i.bind(i,2230))},2230:(t,e,i)=>{"use strict";i.d(e,{default:()=>c});var a=i(5155),r=i(2115),d=i(7899),n=i(8459),o=i(3831);function s({product:t}){let[e,i]=(0,r.useState)(!1),{addItem:s,removeItem:c}=(0,o._)(),l=(0,o._)((0,r.useMemo)(()=>e=>e.items.find(e=>e.product_id===t.id)?.quantity??0,[t.id]))>0,u=async a=>{if(a?.preventDefault(),a?.stopPropagation(),!e){i(!0);try{if(l)return void await c(t.id);await s(t,1)}finally{i(!1)}}};return(0,a.jsx)("button",{onClick:u,type:"button",disabled:e||0===t.stock_quantity,className:`max-w-xs flex-1 flex items-center justify-center border border-transparent rounded-md py-3 px-8 text-base font-medium text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:w-full ${l?"bg-zinc-700 hover:bg-zinc-800":"bg-indigo-600 hover:bg-indigo-700"} ${e||0===t.stock_quantity?"opacity-50 cursor-not-allowed":""}`,children:e?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.A,{className:"mr-2 h-5 w-5"}),"Adding…"]}):l?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.A,{className:"mr-2 h-5 w-5"}),"Remove from Cart"]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.A,{className:"mr-2 h-5 w-5"}),"Add to Cart"]})})}function c({product:t}){let e=(0,r.useMemo)(()=>{let e=Number.isFinite(t.stock_quantity)?t.stock_quantity:0;return e<=0?1:Math.min(e,20)},[t.stock_quantity]),{addItem:i,removeItem:d,updateQuantity:n}=(0,o._)(),c=(0,o._)((0,r.useMemo)(()=>e=>e.items.find(e=>e.product_id===t.id)?.quantity??0,[t.id])),[l,u]=(0,r.useState)(!1);async function m(){if(!l&&0!==t.stock_quantity&&!(c>=e)){u(!0);try{if(0===c)return void await i(t,1);await n(t.id,c+1)}finally{u(!1)}}}async function y(){if(!l&&0!==t.stock_quantity&&!(c<=0)){u(!0);try{if(1===c)return void await d(t.id);await n(t.id,c-1)}finally{u(!1)}}}return(0,a.jsxs)("div",{className:"mt-10",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:"Quantity"}),(0,a.jsxs)("div",{className:"inline-flex items-center rounded-md border border-gray-300 dark:border-zinc-700 overflow-hidden",children:[(0,a.jsx)("button",{type:"button",onClick:y,disabled:l||0===t.stock_quantity||0===c,className:"px-3 py-2 text-gray-700 dark:text-gray-200 disabled:opacity-50",children:"−"}),(0,a.jsx)("input",{inputMode:"numeric",value:String(c),readOnly:!0,className:"w-16 text-center bg-white dark:bg-zinc-900 dark:text-white py-2 outline-none","aria-label":"Quantity",disabled:0===t.stock_quantity}),(0,a.jsx)("button",{type:"button",onClick:m,disabled:l||0===t.stock_quantity||c>=e,className:"px-3 py-2 text-gray-700 dark:text-gray-200 disabled:opacity-50",children:"+"})]}),t.stock_quantity>0&&(0,a.jsxs)("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Max ",e]})]}),(0,a.jsx)("div",{className:"mt-4 flex",children:(0,a.jsx)(s,{product:t})})]})}},3831:(t,e,i)=>{"use strict";i.d(e,{_:()=>d});var a=i(1934),r=i(9311);let d=(0,a.v)()((0,r.Zr)((t,e)=>({items:[],mode:"local",hydrating:!1,setMode:e=>t({mode:e}),hydrateFromDb:async()=>{if("db"!==e().mode)return;t({hydrating:!0});let i=await fetch("/api/cart/list",{method:"GET",headers:{"Cache-Control":"no-cache"}}),a=await i.json().catch(()=>null);try{if(!i.ok)throw Error(a?.error||"Failed to load cart");t({items:Array.isArray(a?.items)?a.items:[]})}finally{t({hydrating:!1})}},addItem:async(i,a=1)=>{let r=Number.isFinite(a)?Math.max(1,Math.floor(a)):1;if("db"===e().mode){t(t=>t.items.find(t=>t.product_id===i.id)?{items:t.items.map(t=>t.product_id===i.id?{...t,quantity:t.quantity+r}:t)}:{items:[...t.items,{id:"pending",user_id:"",product_id:i.id,quantity:r,product:i}]});let a=await fetch("/api/cart/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:i.id,quantity:r})}),d=await a.json().catch(()=>null);if(!a.ok)throw await e().hydrateFromDb(),Error(d?.error||"Failed to add to cart");await e().hydrateFromDb();return}t(t=>t.items.find(t=>t.product_id===i.id)?{items:t.items.map(t=>t.product_id===i.id?{...t,quantity:t.quantity+r}:t)}:{items:[...t.items,{id:Math.random().toString(36).substring(7),user_id:"",product_id:i.id,quantity:r,product:i}]})},removeItem:async i=>{if("db"===e().mode){t(t=>({items:t.items.filter(t=>t.product_id!==i)}));let a=await fetch("/api/cart/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:i})}),r=await a.json().catch(()=>null);if(!a.ok)throw await e().hydrateFromDb(),Error(r?.error||"Failed to remove from cart");return}t(t=>({items:t.items.filter(t=>t.product_id!==i)}))},updateQuantity:async(i,a)=>{if("db"===e().mode){t(t=>({items:t.items.map(t=>t.product_id===i?{...t,quantity:a}:t).filter(t=>t.quantity>0)}));let r=await fetch("/api/cart/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:i,quantity:a})}),d=await r.json().catch(()=>null);if(!r.ok)throw await e().hydrateFromDb(),Error(d?.error||"Failed to update cart");return}t(t=>({items:t.items.map(t=>t.product_id===i?{...t,quantity:a}:t)}))},clearCart:async()=>{if("db"===e().mode){t({items:[]});let i=await fetch("/api/cart/clear",{method:"POST"}),a=await i.json().catch(()=>null);if(!i.ok)throw await e().hydrateFromDb(),Error(a?.error||"Failed to clear cart");return}t({items:[]})},totalItems:()=>e().items.reduce((t,e)=>t+e.quantity,0),totalPrice:()=>e().items.reduce((t,e)=>t+e.product.price*e.quantity,0)}),{name:"cart-storage"}))}},t=>{t.O(0,[500,437,651,441,794,358],()=>t(t.s=1316)),_N_E=t.O()}]);