(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{548:e=>{e.exports={style:{fontFamily:"'Inter', 'Inter Fallback'",fontStyle:"normal"},className:"__className_f367f3"}},1743:()=>{},1934:(e,t,r)=>{"use strict";r.d(t,{v:()=>n});var a=r(2115);let i=e=>{let t,r=new Set,a=(e,a)=>{let i="function"==typeof e?e(t):e;if(!Object.is(i,t)){let e=t;t=(null!=a?a:"object"!=typeof i||null===i)?i:Object.assign({},t,i),r.forEach(r=>r(t,e))}},i=()=>t,s={setState:a,getState:i,getInitialState:()=>n,subscribe:e=>(r.add(e),()=>r.delete(e))},n=t=e(a,i,s);return s},s=e=>{let t=e?i(e):i,r=e=>(function(e,t=e=>e){let r=a.useSyncExternalStore(e.subscribe,a.useCallback(()=>t(e.getState()),[e,t]),a.useCallback(()=>t(e.getInitialState()),[e,t]));return a.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},n=e=>e?s(e):s},2248:(e,t,r)=>{"use strict";r.d(t,{default:()=>u});var a=r(5155),i=r(8500),s=r.n(i),n=r(7882),o=r(7899),d=r(8401),l=r(8340);let c=(0,l.A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),m=(0,l.A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);function u(){let{data:e}=(0,n.useSession)(),t="admin"===e?.user?.role;return(0,a.jsx)("nav",{className:"bg-white border-b border-gray-200 dark:bg-zinc-900 dark:border-zinc-800",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between h-16",children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(s(),{href:t?"/admin":"/",className:"flex-shrink-0 flex items-center",children:(0,a.jsx)("span",{className:"text-xl font-bold text-indigo-600",children:"Aromatic Petals"})}),(0,a.jsx)("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:t?(0,a.jsx)(s(),{href:"/admin",className:"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium",children:"Admin"}):(0,a.jsx)(s(),{href:"/products",className:"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium",children:"Products"})})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[!t&&(0,a.jsx)(s(),{href:"/cart",className:"text-gray-500 hover:text-gray-700 p-2",children:(0,a.jsx)(o.A,{className:"h-6 w-6"})}),e?(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[t?(0,a.jsx)(s(),{href:"/admin",className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)(d.A,{className:"h-6 w-6"})}):(0,a.jsx)(s(),{href:"/profile",className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)(c,{className:"h-6 w-6"})}),(0,a.jsx)("button",{onClick:()=>(0,n.signOut)(),className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)(m,{className:"h-6 w-6"})})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(s(),{href:"/auth/login",className:"text-gray-500 hover:text-gray-700 text-sm font-medium",children:"Log in"}),(0,a.jsx)(s(),{href:"/auth/register",className:"bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700",children:"Sign up"})]})]})]})})})}},3831:(e,t,r)=>{"use strict";r.d(t,{_:()=>s});var a=r(1934),i=r(9311);let s=(0,a.v)()((0,i.Zr)((e,t)=>({items:[],mode:"local",hydrating:!1,setMode:t=>e({mode:t}),hydrateFromDb:async()=>{if("db"!==t().mode)return;e({hydrating:!0});let r=await fetch("/api/cart/list",{method:"GET",headers:{"Cache-Control":"no-cache"}}),a=await r.json().catch(()=>null);try{if(!r.ok)throw Error(a?.error||"Failed to load cart");e({items:Array.isArray(a?.items)?a.items:[]})}finally{e({hydrating:!1})}},addItem:async(r,a=1)=>{let i=Number.isFinite(a)?Math.max(1,Math.floor(a)):1;if("db"===t().mode){e(e=>e.items.find(e=>e.product_id===r.id)?{items:e.items.map(e=>e.product_id===r.id?{...e,quantity:e.quantity+i}:e)}:{items:[...e.items,{id:"pending",user_id:"",product_id:r.id,quantity:i,product:r}]});let a=await fetch("/api/cart/add",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:r.id,quantity:i})}),s=await a.json().catch(()=>null);if(!a.ok)throw await t().hydrateFromDb(),Error(s?.error||"Failed to add to cart");await t().hydrateFromDb();return}e(e=>e.items.find(e=>e.product_id===r.id)?{items:e.items.map(e=>e.product_id===r.id?{...e,quantity:e.quantity+i}:e)}:{items:[...e.items,{id:Math.random().toString(36).substring(7),user_id:"",product_id:r.id,quantity:i,product:r}]})},removeItem:async r=>{if("db"===t().mode){e(e=>({items:e.items.filter(e=>e.product_id!==r)}));let a=await fetch("/api/cart/remove",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:r})}),i=await a.json().catch(()=>null);if(!a.ok)throw await t().hydrateFromDb(),Error(i?.error||"Failed to remove from cart");return}e(e=>({items:e.items.filter(e=>e.product_id!==r)}))},updateQuantity:async(r,a)=>{if("db"===t().mode){e(e=>({items:e.items.map(e=>e.product_id===r?{...e,quantity:a}:e).filter(e=>e.quantity>0)}));let i=await fetch("/api/cart/update",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({product_id:r,quantity:a})}),s=await i.json().catch(()=>null);if(!i.ok)throw await t().hydrateFromDb(),Error(s?.error||"Failed to update cart");return}e(e=>({items:e.items.map(e=>e.product_id===r?{...e,quantity:a}:e)}))},clearCart:async()=>{if("db"===t().mode){e({items:[]});let r=await fetch("/api/cart/clear",{method:"POST"}),a=await r.json().catch(()=>null);if(!r.ok)throw await t().hydrateFromDb(),Error(a?.error||"Failed to clear cart");return}e({items:[]})},totalItems:()=>t().items.reduce((e,t)=>e+t.quantity,0),totalPrice:()=>t().items.reduce((e,t)=>e+t.product.price*t.quantity,0)}),{name:"cart-storage"}))},6854:(e,t,r)=>{Promise.resolve().then(r.t.bind(r,8500,23)),Promise.resolve().then(r.t.bind(r,548,23)),Promise.resolve().then(r.t.bind(r,1743,23)),Promise.resolve().then(r.bind(r,2248)),Promise.resolve().then(r.bind(r,6862))},6862:(e,t,r)=>{"use strict";r.d(t,{Providers:()=>d});var a=r(5155),i=r(7882),s=r(2115),n=r(3831);function o(){return!function(){let{data:e,status:t}=(0,i.useSession)(),r=(0,s.useRef)(!1);(0,s.useEffect)(()=>{if("loading"===t)return;let a=e?.user?.role;if("authenticated"!==t||"admin"===a){n._.getState().setMode("local"),r.current=!1;return}n._.getState().setMode("db"),r.current||(r.current=!0,n._.getState().hydrateFromDb())},[e,t])}(),null}function d({children:e}){return(0,a.jsxs)(i.SessionProvider,{children:[(0,a.jsx)(o,{}),e]})}},7899:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(8340).A)("shopping-cart",[["circle",{cx:"8",cy:"21",r:"1",key:"jimo8o"}],["circle",{cx:"19",cy:"21",r:"1",key:"13723u"}],["path",{d:"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12",key:"9zh506"}]])},8401:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a=(0,r(8340).A)("layout-dashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]])},9311:(e,t,r)=>{"use strict";r.d(t,{Zr:()=>i});let a=e=>t=>{try{let r=e(t);if(r instanceof Promise)return r;return{then:e=>a(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>a(t)(e)}}},i=(e,t)=>(r,i,s)=>{let n,o={storage:function(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var t;let a=e=>null===e?null:JSON.parse(e,void 0),i=null!=(t=r.getItem(e))?t:null;return i instanceof Promise?i.then(a):a(i)},setItem:(e,t)=>r.setItem(e,JSON.stringify(t,void 0)),removeItem:e=>r.removeItem(e)}}(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},d=!1,l=0,c=new Set,m=new Set,u=o.storage;if(!u)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...e)},i,s);let h=()=>{let e=o.partialize({...i()});return u.setItem(o.name,{state:e,version:o.version})},y=s.setState;s.setState=(e,t)=>(y(e,t),h());let f=e((...e)=>(r(...e),h()),i,s);s.getInitialState=()=>f;let x=()=>{var e,t;if(!u)return;let s=++l;d=!1,c.forEach(e=>{var t;return e(null!=(t=i())?t:f)});let y=(null==(t=o.onRehydrateStorage)?void 0:t.call(o,null!=(e=i())?e:f))||void 0;return a(u.getItem.bind(u))(o.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===o.version)return[!1,e.state];else{if(o.migrate){let t=o.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;if(s!==l)return;let[a,d]=e;if(r(n=o.merge(d,null!=(t=i())?t:f),!0),a)return h()}).then(()=>{s===l&&(null==y||y(n,void 0),n=i(),d=!0,m.forEach(e=>e(n)))}).catch(e=>{s===l&&(null==y||y(void 0,e))})};return s.persist={setOptions:e=>{o={...o,...e},e.storage&&(u=e.storage)},clearStorage:()=>{null==u||u.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>x(),hasHydrated:()=>d,onHydrate:e=>(c.add(e),()=>{c.delete(e)}),onFinishHydration:e=>(m.add(e),()=>{m.delete(e)})},o.skipHydration||x(),n||f}}},e=>{e.O(0,[970,500,909,441,794,358],()=>e(e.s=6854)),_N_E=e.O()}]);